# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1l8JPa4xlGGFjFo6qTFeYb1HXrARgDPOl
"""

import streamlit as st
import numpy as np
import joblib

# Load model and scaler
model = joblib.load("src/model.pkl")
scaler = joblib.load("src/scaler.pkl")

st.title("üìä Insurance Subscription Predictor")
st.write("Enter user details to predict if they will subscribe.")

# Input fields
age = st.number_input("Age", 18, 100)
balance = st.number_input("Balance")
duration = st.number_input("Call Duration")
campaign = st.number_input("Campaign Contacts", 1)
previous = st.number_input("Previous Contacts")
pdays = st.number_input("Days Since Last Contact", -1)

job = st.selectbox("Job", ['admin.', 'technician', 'retired'])
marital = st.selectbox("Marital", ['married', 'single'])
education = st.selectbox("Education", ['secondary', 'tertiary'])
housing = st.selectbox("Housing Loan", ['yes', 'no'])
loan = st.selectbox("Personal Loan", ['yes', 'no'])
contact = st.selectbox("Contact", ['cellular', 'telephone'])
month = st.selectbox("Month", ['may', 'jul'])  # extend as needed
poutcome = st.selectbox("Previous Outcome", ['success', 'failure'])

# Encoding dictionaries (must match training)
job_map = {'admin.': 0, 'technician': 1, 'retired': 2}
marital_map = {'married': 0, 'single': 1}
education_map = {'secondary': 0, 'tertiary': 1}
housing_map = {'yes': 1, 'no': 0}
loan_map = {'yes': 1, 'no': 0}
contact_map = {'cellular': 0, 'telephone': 1}
month_map = {'may': 0, 'jul': 1}
poutcome_map = {'success': 1, 'failure': 0}

# Feature engineering
balance_age_ratio = balance / age
duration_campaign_ratio = duration / campaign
is_retired = 1 if job == 'retired' else 0
previous_campaigns_success_rate = previous / campaign
contacted_before = 1 if pdays > -1 else 0

# Form the input vector
X_input = np.array([[
    age, job_map[job], marital_map[marital], education_map[education],
    housing_map[housing], loan_map[loan], contact_map[contact], month_map[month],
    pdays, previous, poutcome_map[poutcome], campaign,
    balance, duration,
    balance_age_ratio, duration_campaign_ratio, is_retired,
    previous_campaigns_success_rate, contacted_before
]])

# Scale
X_scaled = scaler.transform(X_input)

# Predict
if st.button("Predict"):
    prediction = model.predict(X_scaled)[0]
    result = "‚úÖ YES: Likely to Subscribe" if prediction == 1 else "‚ùå NO: Unlikely to Subscribe"
    st.success(f"Prediction: {result}")